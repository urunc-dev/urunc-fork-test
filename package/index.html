
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../unikernel-support/">
      
      
        <link rel="next" href="pre-built/">
      
      
      <link rel="icon" href="../img/urunc-logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Building/Packaging unikernels - urunc Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#annotations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="urunc Documentation" class="md-header__button md-logo" aria-label="urunc Documentation" data-md-component="logo">
      
  <img src="../img/urunc-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            urunc Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Building/Packaging unikernels
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.821 9.821 0 0 0 17.64 0 9.821 9.821 0 0 0-17.64 0"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="urunc Documentation" class="md-nav__button md-logo" aria-label="urunc Documentation" data-md-component="logo">
      
  <img src="../img/urunc-logo.png" alt="logo">

    </a>
    urunc Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hypervisor-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VMM/Sandbox Support
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../unikernel-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unikernel Support
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="./" class="md-nav__link md-nav__link--active">
              
  
  
  <span class="md-ellipsis">
    Building/Packaging unikernels
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link md-nav__link--active" for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Building/Packaging unikernels
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pre-built/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pre-built unikernels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reusing unikernels from OCI images
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rootfs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating rootfs for unikernels
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../design/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Design
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../design/seccomp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Seccomp
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../developer-guide/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/Code-of-Conduct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/contribute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup a Dev environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/maintainers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maintainers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Policy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/timestamps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execution time breakdown
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pkg.go.dev/github.com/nubificus/urunc@v0.3.0/pkg/unikontainers" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../tutorials/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/How-to-urunc-on-k8s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to use urunc with k8s
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/Non-root-monitor-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Non-root execution of monitor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/eks-tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EKS Setup for urunc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/knative/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knative + urunc: Deploying Serverless Unikernels
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Annotations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools-to-construct-oci-images-with-uruncs-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Tools to construct OCI images with urunc's annotations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tools to construct OCI images with urunc&#39;s annotations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bunny" class="md-nav__link">
    <span class="md-ellipsis">
      bunny
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bunny">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packaging-a-unikernel-with-bunny" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging a unikernel with bunny
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bunix" class="md-nav__link">
    <span class="md-ellipsis">
      bunix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bunix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packaging-a-unikernel-with-bunix" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging a unikernel with bunix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Building/Packaging unikernels</h1>

<p>The <a href="https://github.com/opencontainers/image-spec">OCI (Open Container Initiative) image
format</a> is a standardized
specification for packaging and distributing containerized applications across
different platforms and container runtimes. It defines a common structure for
container images, including their metadata, layers, and filesystem content.</p>
<p>Since <code>urunc</code> is an OCI-compatible container runtime, it expects the unikernel
to be placed inside an OCI container image. Nevertheless, in order to
differentiate between traditional container images and unikernel OCI images,
<code>urunc</code> makes use of annotations or a metadata file (<code>urunc.json</code>) inside the
container's rootfs.</p>
<p>To facilitate the process, we provide various tools that build and package a unikernel
binary, along with the application's necessary files in a container image and
set the respective annotations. In particular, we can produce an OCI image with
all <code>urunc</code>'s annotations using:</p>
<ol>
<li><a href="https://github.com/nubificus/bunny">bunny</a> a tool that builds and packages unikernels
    using buildkit's LLB and can also act as a frontend for
   <a href="https://github.com/moby/buildkit?tab=readme-ov-file#output">buildkit</a>.</li>
<li><a href="https://github.com/nubificus/bunix">bunix</a> which uses <a href="https://github.com/NixOS/nix">Nix
   packages</a> to package a unikernel as an OCI image.</li>
</ol>
<p>In this section, we will first explain all the annotations that <code>urunc</code>
expects, in order to handle unikernels and describe how to build and package
unikernels as OCI images using the aforementioned tools.</p>
<p><strong>Quick links:</strong></p>
<ul>
<li><a href="../package/pre-built">Packaging pre-built unikernels</a></li>
<li><a href="../package/reuse">Using unikernels from existing OCI images</a></li>
<li><a href="../package/rootfs">Packaging and creating unikernel's rootfs</a></li>
</ul>
<h2 id="annotations">Annotations</h2>
<p><a href="https://github.com/opencontainers/image-spec/blob/main/annotations.md">OCI
annotations</a>
are key-value metadata used to describe and provide additional
context for container images and runtime configurations within the OCI
specification. Using these annotations developers can
embed non-essential information about containers, such as version details,
licensing, build information, or custom runtime parameters, without affecting
the core functionality of the container itself.
The annotations can be placed in several components of the specification.
However, in the case of <code>urunc</code> we are interested about annotations which can
reach the container runtime.</p>
<p>Using these annotations <code>urunc</code> receives information regarding the type of the
unikernel, the VMM or sandbox mechanism to use and more. For the time being, the
required annotations are the following:</p>
<ul>
<li><code>com.urunc.unikernel.unikernelType</code>: The type of the unikernel. Currently
  supported values: a) unikraft, b) rumprun, c) mirage.</li>
<li><code>com.urunc.unikernel.hypervisor</code>: The VMM or sandbox monitor to run the
  unikernel Currently supported values: a) <code>qemu</code>, b) <code>firecracker</code>, c) <code>spt</code>,
  d) <code>hvt</code>.</li>
<li><code>com.urunc.unikernel.binary</code>: The path to the unikernel binary inside the
  container's rootfs</li>
<li><code>com.urunc.unikernel.cmdline</code>: The application's cmdline to pass to the
  unikernel.</li>
</ul>
<p>Except of the above, <code>urunc</code> accepts the following optional annotations:</p>
<ul>
<li><code>com.urunc.unikernel.initrd</code>: The path to the initrd of the unikernel inside
  the container's rootfs.</li>
<li><code>com.urunc.unikernel.unikernelVersion</code>: The version of the unikernel framework (e.g.
  0.17.0).</li>
<li><code>com.urunc.unikernel.block</code>: The path to a block image inside container's
  rootfs, which will get attached to the unikernel.</li>
<li><code>com.urunc.unikernel.blkMntPoint</code>: The mount point of the block image to
  attach in the unikernel.</li>
<li><code>com.urunc.unikernel.useDMBlock</code>: A boolean value that if it is <code>true</code>, requests
  from <code>urunc</code> to mount the container's image rootfs in the unikernel, Requires
  the <code>devmapper</code> snapshotter.</li>
</ul>
<p>Due to the fact that <a href="https://www.docker.com/">Docker</a> and some high-level
container runtimes do not pass the image annotations to the underlying container
runtime, <code>urunc</code> can also read the above information from a file inside the
container's rootfs. The file should be named <code>urunc.json</code>, it should be
placed in the root directory of the container's rootfs and it should have a JSON
format with the above information, where the values are base64 encoded.</p>
<h2 id="tools-to-construct-oci-images-with-uruncs-annotations">Tools to construct OCI images with <code>urunc</code>'s annotations</h2>
<p>As previously mentioned we currently provide 2 different tools to build and
package unikernels in OCI images with <code>urunc</code>'s annotations.</p>
<h3 id="bunny">bunny</h3>
<p>In an effort to simplify the process of building various unikernels, we built
<a href="https://github.com/nubificus/bunny">bunny</a>. Except of building unikernels <a href="https://github.com/nubificus/bunny">bunny</a>
can also pack existing unikernels (whether locally or from OCI images) as OCI images
for <code>urunc</code>. At its core <a href="https://github.com/nubificus/bunny">bunny</a> leverages
<a href="https://github.com/moby/buildkit?tab=readme-ov-file#exploring-llb">buildkit's LLB</a>,
allowing us to create OCI images from any type of file. Currently <a href="https://github.com/nubificus/bunny">bunny</a> can
process two formats of files: a) the typical Dockerfile-like syntax files and b)
<code>bunnyfile</code>, a specialized YAML-based file.</p>
<p>When using Dockerfile-like files, <a href="https://github.com/nubificus/bunny">bunny</a>
can only package pre-built unikernel images; it cannot build them. This format
is primarily retained for compatibility with pun and bima, which are no longer
maintained. Currently, <a href="https://github.com/nubificus/bunny">bunny</a>
can handle the following <em>instructions</em>:</p>
<ul>
<li><code>FROM</code>: Specify an existing OCI image to use as a base.</li>
<li><code>COPY</code>: this works as in Dockerfiles. At this moment, only a single copy
  operation per <em>instruction</em> (think one copy per line). These files are copied
  inside the container's image rootfs.</li>
<li><code>LABEL</code>: all LABEL <em>instructions</em> are added as annotations to the container's
  image. They are also added to a special <code>urunc.json</code> inside the container's image
  rootfs.</li>
</ul>
<p>To further extend the functionality and provide a common interface to facilitate
unikernel building, we defined <code>bunnyfile</code>. It is a YAML-based special file that
<a href="https://github.com/nubificus/bunny">bunny</a> transforms to LLB with all the
necessary steps to build the respective unikernel. Except of building
unikernels, <a href="https://github.com/nubificus/bunny">bunny</a> can also be used to build or append files in the unikernel's
rootfs.</p>
<p>The current syntax of <code>bunnyfile</code> is the following one:</p>
<pre><code>#syntax=harbor.nbfc.io/nubificus/bunny:latest   # [1] Set bunnyfile syntax for automatic recognition from buildkit.
version: v0.1                                   # [2] Bunnyfile version.

platforms:                                      # [3] The target platform for building/packaging.
  framework: unikraft                           # [3a] The unikernel framework.
  version: v0.15.0                              # [3b] The version of the unikernel framework.
  monitor: qemu                                 # [3c] The hypervisor/VMM or any other kind of monitor.
  architecture: x86                             # [3d] The target architecture.

rootfs:                                         # [4] (Optional) Specifies the rootfs of the unikernel.
  from: local                                   # [4a] (Optional) The source of the rootfs.
  path: initrd                                  # [4b] (Required if from is not scratch) The path in the source, where the prebuilt rootfs file resides.
  type: initrd                                  # [4c] (optional) The type of rootfs (e.g. initrd, raw, block)
  include:                                      # [4d] (Optional) A list of local files to include in the rootfs
    - src:dst

kernel:                                         # [5] Specify a prebuilt kernel to use
  from: local                                   # [5a] Specify the source of a prebuilt kernel.
  path: kernel                                  # [5b] The path where the kernel image resides.

cmdline: hello                                  # [6] The cmdline of the app.

</code></pre>
<p>For more information regarding the <code>bunnyfile</code> please take a look at the
respective section of <a href="https://github.com/nubificus/bunny?tab=readme-ov-file#the-bunnyfile">bunny's
README</a>.
Furthermore, you can find various different examples and use cases for
<a href="https://github.com/nubificus/bunny">bunny</a> in the <a href="https://github.com/nubificus/bunny/tree/main/examples">examples directory of
bunny's repository</a>.</p>
<h4 id="packaging-a-unikernel-with-bunny">Packaging a unikernel with bunny</h4>
<p>Since <a href="https://github.com/nubificus/bunny">bunny</a> uses
<a href="https://github.com/moby/buildkit?tab=readme-ov-file#output">buildkit</a> it
supports two modes of execution. In the first mode it acts as a <a href="https://docs.docker.com/build/buildkit/frontend/">buildkit
frontend</a> and in the second
mode it outputs a LLB which can be passed to <code>buildctl</code>.Therefore,
<a href="https://github.com/nubificus/bunny">bunny</a> depends on
<a href="https://github.com/moby/buildkit?tab=readme-ov-file#output">buildkit</a> which
should be installed. However, if <a href="https://www.docker.com/">docker</a> is already
installed, the frontend execution mode of <a href="https://github.com/nubificus/bunny">bunny</a>
can be used directly without building or installing anything.</p>
<p>It is important to note that if we
want to use <a href="https://github.com/nubificus/bunny">bunny</a> as a frontend for buildkit
we need to start the Containerfile with the following line:</p>
<pre><code class="language-Dockerfile">#syntax=harbor.nbfc.io/nubificus/bunny:&lt;version&gt;
</code></pre>
<p><strong><em>Using a Dockerfile-like syntax file</em></strong></p>
<p>If we want to package a locally built Nginx Unikraft unikernel, we
can define the a Dockerfile-like syntax file as:</p>
<pre><code class="language-Dockerfile">#syntax=harbor.nbfc.io/nubificus/bunny:latest
FROM scratch

COPY nginx-qemu-x86_64-initrd_qemu-x86_64 /unikernel/kernel
COPY rootfs.cpio /unikernel/initrd

LABEL &quot;com.urunc.unikernel.binary&quot;=/unikernel/kernel
LABEL &quot;com.urunc.unikernel.initrd&quot;=/unikernel/initrd
LABEL &quot;com.urunc.unikernel.cmdline&quot;=&quot;nginx -c /nginx/conf/nginx.conf&quot;
LABEL &quot;com.urunc.unikernel.unikernelType&quot;=&quot;unikraft&quot;
LABEL &quot;com.urunc.unikernel.hypervisor&quot;=&quot;qemu&quot;
</code></pre>
<p><strong><em>Using bunnyfile</em></strong></p>
<p>If we want to package the same unikernel, using <code>bunnyfile</code>, we have to
define the file as:</p>
<pre><code>#syntax=harbor.nbfc.io/nubificus/bunny:latest
version: v0.1

platforms:
  framework: unikraft
  monitor: qemu
  architecture: x86

rootfs:
  from: local
  path: rootfs.cpio

kernel:
  from: local
  path: nginx-qemu-x86_64-initrd_qemu-x86_64

cmdline: nginx -c /nginx/conf/nginx.conf
</code></pre>
<p>and we can build it with a docker command:</p>
<pre><code class="language-bash">docker build -f bunnyfile -t nubificus/urunc/nginx-unikraft-qemu:test .
</code></pre>
<blockquote>
<p><strong>NOTE</strong>: We can use the above command and switch form bunnyfile to the
Dockerfile-like file and build the same unikernel OCI image.</p>
</blockquote>
<p>For more information check <a href="https://github.com/nubificus/bunny?tab=readme-ov-file#bunny-build-and-package-unikernels-like-containers">bunny's README</a>.</p>
<h3 id="bunix">bunix</h3>
<p>For Nix users, we have created a set of Nix scripts that we maintain in the
<a href="https://github.com/nubificus/bunix">bunix</a> repository to build container
images for <code>urunc</code>. In contrast to the previous tools,
<a href="https://github.com/nubificus/bunix">bunix</a> uses a nix file to define the
files to package as a container image, along with the <code>urunc</code> annotations. In
particular, this file is the <code>args.nix</code> file, which expects the same fields:</p>
<ul>
<li>name: the name of the container image that Nix will build</li>
<li>tag: the tag of the container image that Nix will build</li>
<li>files: a list of key-value pairs with all the files to copy inside the
  container image. The key-value pairs have the following format:
  <code>"&lt;path-based-on-cwd&gt;" = "&lt;path-inside-container&gt;"</code>.</li>
<li>annotations: a list will all the <code>urunc</code> annotations.</li>
</ul>
<h4 id="packaging-a-unikernel-with-bunix">Packaging a unikernel with bunix</h4>
<p>A necessary requirement to use <a href="https://github.com/nubificus/bunix">bunix</a>
is the presence of <a href="https://github.com/NixOS/nix">Nix package manager</a>. Then
using <a href="https://github.com/nubificus/bunix">bunix</a> is as simple as completing
the <code>args.nix</code> file.</p>
<p>For example to package a locally built Rumprun Hello world unikernel running on
top of Solo5-hvt, we should set the <code>args.nix</code> file as:</p>
<pre><code class="language-Nix">{
  name = &quot;nginx-unikraft-qemu&quot;;
  tag = &quot;test&quot;;
  files = {
    &quot;./nginx-qemu-x86_64-initrd_qemu-x86_64&quot; = &quot;/unikernel/kernel&quot;;
    &quot;./rootfs.cpio&quot; = &quot;/unikernel/initrd&quot;;
  };
  annotations = {
    unikernelType = &quot;unikraft&quot;;
    hypervisor = &quot;qemu&quot;;
    binary = &quot;/unikernel/kernel&quot;;
    cmdline = &quot;nginx -c /nginx/conf/nginx.conf&quot;;
    unikernelVersion = &quot;&quot;;
    initrd = &quot;/unikernel/initrd&quot;;
    block = &quot;&quot;;
    blkMntPoint = &quot;&quot;;
  };
}
</code></pre>
<p>Then we can build the image by simply running the following command
inside the repository:</p>
<pre><code class="language-bash">nix-build default.nix
</code></pre>
<p>The above command will create a container image in a tar inside Nix's store. For
easier access of the tar, Nix creates a symlink of the tar file in the CWD. The
symlink will be named as <code>result</code>. Therefore, we can load the container image with:</p>
<pre><code class="language-bash">docker load &lt; result
</code></pre>
<p>Please check <a href="https://github.com/nubificus/bunix">bunix's README</a> for more information.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 - 2025 Nubificus LTD
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>