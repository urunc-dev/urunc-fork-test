
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../unikernel-support/">
      
      
        <link rel="next" href="../design/">
      
      
      <link rel="icon" href="../img/urunc-logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Packaging unikernels - urunc Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#packaging-unikernels-in-oci-images-for-urunc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="urunc Documentation" class="md-header__button md-logo" aria-label="urunc Documentation" data-md-component="logo">
      
  <img src="../img/urunc-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            urunc Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Packaging unikernels
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.821 9.821 0 0 0 17.64 0 9.821 9.821 0 0 0-17.64 0"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="urunc Documentation" class="md-nav__button md-logo" aria-label="urunc Documentation" data-md-component="logo">
      
  <img src="../img/urunc-logo.png" alt="logo">

    </a>
    urunc Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hypervisor-support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VMM/Sandbox Support
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../unikernel-support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unikernel Support
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Packaging unikernels
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Packaging unikernels
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Annotations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools-to-construct-oci-images-with-uruncs-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Tools to construct OCI images with urunc's annotations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tools to construct OCI images with urunc&#39;s annotations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bima" class="md-nav__link">
    <span class="md-ellipsis">
      Bima
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bima">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packaging-a-rumprun-unikernel-with-bima" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging a rumprun unikernel with bima
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pun" class="md-nav__link">
    <span class="md-ellipsis">
      Pun
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pun">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packaging-a-unikraft-unikernel-with-pun" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging a Unikraft unikernel with pun
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bimanix" class="md-nav__link">
    <span class="md-ellipsis">
      Bimanix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bimanix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packaging-a-unikernel-with-bimanix" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging a unikernel with bimanix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../design/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Design
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../design/seccomp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Seccomp
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../developer-guide/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/Code-of-Conduct/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup a Dev environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/maintainers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maintainers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer-guide/timestamps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Execution time breakdown
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://pkg.go.dev/github.com/nubificus/urunc@v0.3.0/pkg/unikontainers" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../tutorials/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/How-to-urunc-on-k8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use urunc with k8s
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Annotations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tools-to-construct-oci-images-with-uruncs-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Tools to construct OCI images with urunc's annotations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tools to construct OCI images with urunc&#39;s annotations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bima" class="md-nav__link">
    <span class="md-ellipsis">
      Bima
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bima">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packaging-a-rumprun-unikernel-with-bima" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging a rumprun unikernel with bima
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pun" class="md-nav__link">
    <span class="md-ellipsis">
      Pun
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pun">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packaging-a-unikraft-unikernel-with-pun" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging a Unikraft unikernel with pun
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bimanix" class="md-nav__link">
    <span class="md-ellipsis">
      Bimanix
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bimanix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#packaging-a-unikernel-with-bimanix" class="md-nav__link">
    <span class="md-ellipsis">
      Packaging a unikernel with bimanix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="packaging-unikernels-in-oci-images-for-urunc">Packaging unikernels in OCI images for <code>urunc</code></h1>
<p>The <a href="https://github.com/opencontainers/image-spec">OCI (Open Container Initiative) image
format</a> is a standardized
specification for packaging and distributing containerized applications across
different platforms and container runtimes. It defines a common structure for
container images, including their metadata, layers, and filesystem content.
Since <code>urunc</code> is an OCI-compatible container runtime, it expects the unikernel
to be placed inside an OCI container image.</p>
<p>Nevertheless, in order to differentiate between traditional container images
and unikernel OCI images, <code>urunc</code> makes use of annotations or a metadata file
(<code>urunc.json</code>) inside the container's rootfs.</p>
<p>To facilitate the process, we provide various tools that package a unikernel
binary, along with the application's necessary files in a container image and
set the respective annotations. In particular, we can produce an OCI image with
all <code>urunc</code>'s annotations using:
1. <a href="https://github.com/nubificus/bima">bima</a> a standalone tool that communicates
   with <a href="https://github.com/containerd/containerd">containerd</a>,
2. <a href="https://github.com/nubificus/pun">pun</a> a tool that constructs a LLB or acts
   as a frontend for
   <a href="https://github.com/moby/buildkit?tab=readme-ov-file#output">buildkit</a> and
3. <a href="https://github.com/nubificus/bimanix">bimanix</a> which uses <a href="https://github.com/NixOS/nix">Nix
   packages</a> to build the image.</p>
<p>In this document, we will first explain all the annotations that <code>urunc</code>
expects, in order to handle unikernels and describe each one of the three ways
to build such OCI images for unikernels.</p>
<h2 id="annotations">Annotations</h2>
<p><a href="https://github.com/opencontainers/image-spec/blob/main/annotations.md">OCI
annotations</a>
are key-value metadata used to describe and provide additional
context for container images and runtime configurations within the OCI
specification. Using these annotations developers can
embed non-essential information about containers, such as version details,
licensing, build information, or custom runtime parameters, without affecting
the core functionality of the container itself.
The annotations can be placed in several components of the specification.
However, in the case of <code>urunc</code> we are interested about annotations which can
reach the container runtime.</p>
<p>Using these annotations <code>urunc</code> receives information regarding the type of the
unikernel, the VMM or sandbox mechanism to use and more. For the time being, the
required annotations are the following:</p>
<ul>
<li><code>com.urunc.unikernel.unikernelType</code>: The type of the unikernel. Currently
  supported values: a) unikraft, b) rumprun.</li>
<li><code>com.urunc.unikernel.hypervisor</code>: The VMM or sandbox monitor to run the
  unikernel Currently supported values: a) <code>qemu</code>, b) <code>firecracker</code>, c) <code>spt</code>,
  d) <code>hvt</code>.</li>
<li><code>com.urunc.unikernel.binary</code>: The path to the unikernel binary inside the
  container's rootfs</li>
<li><code>com.urunc.unikernel.cmdline</code>: The application's cmdline to pass to the
  unikernel.</li>
</ul>
<p>Except of the above, <code>urunc</code> accepts the following optional annotations:</p>
<ul>
<li><code>com.urunc.unikernel.initrd</code>: The path to the initrd of the unikernel inside
  the container's rootfs.</li>
<li><code>com.urunc.unikernel.block</code>: The path to a block image, inside container's
  rootfs, which will get attached to the unikernel.</li>
<li><code>com.urunc.unikernel.blkMntPoint</code>: The mount point of the block image to
  attach in the unikernel.</li>
<li><code>com.urunc.unikernel.unikernelVersion</code>: The version of the unikernel framework (e.g.
  0.17.0).</li>
</ul>
<p>Due to the fact that <a href="https://www.docker.com/">Docker</a> and some high-level
container runtimes do not pass the image annotations to the underlying container
runtime, <code>urunc</code> can also read the above information from a file inside the
container's rootfs. The file should be named <code>urunc.json</code>, it should be
placed in the root directory of the container's rootfs and it should have a JSON
format with the above information, where the values are base64 encoded.</p>
<h2 id="tools-to-construct-oci-images-with-uruncs-annotations">Tools to construct OCI images with <code>urunc</code>'s annotations</h2>
<p>As previously mentioned we currently provide 3 different tools to package
unikernels in OCI images with <code>urunc</code>'s annotations.</p>
<h3 id="bima">Bima</h3>
<p><a href="https://github.com/nubificus/bima">bima</a> uses
<a href="https://github.com/containerd/containerd">containerd</a> to build OCI images. In
particular, <a href="https://github.com/nubificus/bima">bima</a> reads the contents of a
file with a Dockerfile-like syntax. This file can contain a set of
<em>instructions</em> that specify how to package an existing unikernel binary as an
OCI image. The currently supported <em>instructions</em> are:</p>
<ul>
<li><code>FROM</code>: this is not taken into account at the current implementation, but we
  plan to add support for.</li>
<li><code>COPY</code>: this works as in Dockerfiles. At this moment, only a single copy
  operation per <em>instruction</em> (think one copy per line). These files are copied
  inside the container's image rootfs.</li>
<li><code>LABEL</code>: all LABEL <em>instructions</em> are added as annotations to the Container
  image. They are also added to a special <code>urunc.json</code> inside the container's image
  rootfs.</li>
</ul>
<h4 id="packaging-a-rumprun-unikernel-with-bima">Packaging a rumprun unikernel with bima</h4>
<p>The main benefit of <a href="https://github.com/nubificus/bima">bima</a> is that it is a
standalone tool which uses
<a href="https://github.com/containerd/containerd">containerd</a>. Therefore, there are no
dependencies on using it. For instructions to build and install
<a href="https://github.com/nubificus/bima">bima</a> please check <a href="https://github.com/nubificus/bima?tab=readme-ov-file#build-from-source">its
README</a></p>
<p>As a result, to package a unikernel inside an OCI image and setting <code>urunc</code>'s
annotations with <a href="https://github.com/nubificus/bima">bima</a>, we simply need to
construct the Containerfile with all the necessary <em>instructions</em>. For instance,
to package a Redis unikernel that uses Rumprun and runs on top of Solo5, we can
construct the Containerfile as:</p>
<pre><code class="language-Dockerfile"># the FROM instruction will not be parsed
FROM scratch

COPY test-redis.hvt /unikernel/test-redis.hvt
COPY redis.conf /conf/redis.conf

LABEL &quot;com.urunc.unikernel.binary&quot;=/unikernel/test-redis.hvt
LABEL &quot;com.urunc.unikernel.cmdline&quot;='redis-server /data/conf/redis.conf'
LABEL &quot;com.urunc.unikernel.unikernelType&quot;=&quot;rumprun&quot;
LABEL &quot;com.urunc.unikernel.hypervisor&quot;=&quot;hvt&quot;
</code></pre>
<blockquote>
<p>Note: For labels, you can use single quotes, double quotes or no quotes at
all. Defining multiple label key-value pairs in a single LABEL instruction is
not supported.</p>
</blockquote>
<p>As soon as we create the Containerfile we can build the container with:</p>
<pre><code class="language-bash">bima build -t nubificus/image:tag .
</code></pre>
<p>Please check the <a href="https://github.com/nubificus/bima?tab=readme-ov-file#usage">README
file</a> of bima for
more information.</p>
<h3 id="pun">Pun</h3>
<p>As an alternative to <a href="https://github.com/nubificus/bima">bima</a>, we built
<a href="https://github.com/nubificus/pun">pun</a> a tool based on
<a href="https://github.com/moby/buildkit?tab=readme-ov-file#output">buildkit</a>. The main
differentiate between <a href="https://github.com/nubificus/bima">bima</a> and
<a href="https://github.com/nubificus/pun">pun</a> is that
<a href="https://github.com/nubificus/pun">pun</a> supports using existing OCI images with
a unikernel inside. An example of such images is <a href="https://github.com/unikraft/catalog">Unikraft's application
catalog</a>. Therefore, with
<a href="https://github.com/nubificus/pun">pun</a> a user can simply define an existing
image to use and <a href="https://github.com/nubificus/pun">pun</a> will add any other
files inside the container image and of course the necessary annotations.
Both <a href="https://github.com/nubificus/pun">pun</a> and
<a href="https://github.com/nubificus/bima">bima</a> support the same set of <em>instructions</em>
with the difference that <code>FROM</code> is handled properly from
<a href="https://github.com/nubificus/pun">pun</a>.</p>
<h4 id="packaging-a-unikraft-unikernel-with-pun">Packaging a Unikraft unikernel with pun</h4>
<p>Since <a href="https://github.com/nubificus/pun">pun</a> uses
<a href="https://github.com/moby/buildkit?tab=readme-ov-file#output">buildkit</a> it
supports two modes of execution. In the first mode it acts as a <a href="https://docs.docker.com/build/buildkit/frontend/">buildkit
frontend</a> and in the second
mode it outputs a LLB which can be passed to <code>buildctl</code>.Therefore,
<a href="https://github.com/nubificus/pun">pun</a> depends on
<a href="https://github.com/moby/buildkit?tab=readme-ov-file#output">buildkit</a> which
should be installed. However, if <a href="https://www.docker.com/">docker</a> is already
installed, the frontend execution mode of <a href="https://github.com/nubificus/pun">pun</a>
can be used directly without building anything.</p>
<p>Similarly to <a href="https://github.com/nubificus/bima">bima</a> the first step to build
the container is to define the Containerfile. It is important to note that if we
want to use <a href="https://github.com/nubificus/pun">pun</a> as a frontend for buildkit
we need to start the Containerfile with the following line:</p>
<pre><code class="language-Dockerfile">#syntax=harbor.nbfc.io/nubificus/urunc/pun/llb:latest
</code></pre>
<p>Therefore, if we want to package a locally built Ngnix Unikraft unikernel, we
can define the Containerfile as:</p>
<pre><code class="language-Dockerfile">#syntax=harbor.nbfc.io/nubificus/pun:0.1.0
FROM scratch

COPY build/app-nginx_qemu-x86_64 /unikernel/kernel
COPY data.cpio /unikernel/initrd

LABEL com.urunc.unikernel.binary=/unikernel/kernel
LABEL &quot;com.urunc.unikernel.initrd&quot;=/unikernel/initrd
LABEL &quot;com.urunc.unikernel.cmdline&quot;='nginx -c /nginx/conf/nginx.conf'
LABEL &quot;com.urunc.unikernel.unikernelType&quot;=&quot;unikraft&quot;
LABEL &quot;com.urunc.unikernel.hypervisor&quot;=&quot;qemu&quot;
</code></pre>
<p>and we can build it with a docker command:</p>
<pre><code class="language-bash">docker build -f Containerfile -t nubificus/urunc/nginx-unikraft-qemu:test .
</code></pre>
<p>In a similar way, if we want to package an existing Nginx Unikraft unikernel
form <a href="https://github.com/unikraft/catalog">unikraft's catalog</a>, we should define
the Containerfile as:</p>
<pre><code class="language-Dockerfile">#syntax=harbor.nbfc.io/nubificus/pun:0.1.0
FROM unikraft.org/nginx:1.15

LABEL com.urunc.unikernel.binary=&quot;/unikraft/bin/kernel&quot;
LABEL &quot;com.urunc.unikernel.cmdline&quot;=&quot;nginx -c /nginx/conf/nginx.conf&quot;
LABEL &quot;com.urunc.unikernel.unikernelType&quot;=&quot;unikraft&quot;
LABEL &quot;com.urunc.unikernel.hypervisor&quot;=&quot;qemu&quot;
</code></pre>
<p>and we can build it with the same docker command:</p>
<pre><code class="language-bash">docker build -f Containerfile -t nubificus/urunc/nginx-unikraft-qemu:test .
</code></pre>
<blockquote>
<p>Note: For labels, you can use single quotes, double quotes or no quotes at
all. Defining multiple label key-value pairs in a single LABEL instruction is
not supported.</p>
</blockquote>
<p>For more information check <a href="https://github.com/nubificus/pun">pun's README</a>.</p>
<h3 id="bimanix">Bimanix</h3>
<p>For Nix users, we have created a set of Nix scripts that we maintain in the
<a href="https://github.com/nubificus/bimanix">bimanix</a> repository to build container
images for <code>urunc</code>. In contrast to the previous tools,
<a href="https://github.com/nubificus/bimanix">bimanix</a> uses a nix file to define the
files to package as a container image, along with the <code>urunc</code> annotations. In
particular, this file is the <code>args.nix</code> file, which expects the same fields:</p>
<ul>
<li>name: the name of the container image that Nix will build</li>
<li>tag: the tag of the container image that Nix will build</li>
<li>files: a list of key-value pairs with all the files to copy inside the
  container image. The key-value pairs have the following format:
  <code>"&lt;path-based-on-cwd&gt;" = "&lt;path-inside-container&gt;"</code>.</li>
<li>annotations: a list will all the <code>urunc</code> annotations.</li>
</ul>
<h4 id="packaging-a-unikernel-with-bimanix">Packaging a unikernel with bimanix</h4>
<p>A necessary requirement to use <a href="https://github.com/nubificus/bimanix">bimanix</a>
is the presence of <a href="https://github.com/NixOS/nix">Nix package manager</a>. Then
using <a href="https://github.com/nubificus/bimanix">bimanix</a> is as simple as completing
the <code>args.nix</code> file.</p>
<p>For example to package a locally built Rumprun Hello world unikernel running on
top of Solo5-hvt, we should set the <code>args.nix</code> file as:</p>
<pre><code class="language-Nix">{
  name = &quot;hello-rumprun&quot;;
  tag = &quot;latest&quot;;
  files = {
    &quot;./hello.hvt&quot; = &quot;/unikernel/hello.hvt&quot;;
  };
  annotations = {
    unikernelType = &quot;rumprun&quot;;
    hypervisor = &quot;hvt&quot;;
    binary = &quot;/unikernel/hello.hvt&quot;;
    cmdline = &quot;hello&quot;;
    unikernelVersion = &quot;&quot;;
    initrd = &quot;&quot;;
    block = &quot;&quot;;
    blkMntPoint = &quot;&quot;;
  };
}
</code></pre>
<p>Then we can build the image by simply running the following command
inside the repository:</p>
<pre><code class="language-bash">nix-build default.nix
</code></pre>
<p>The above command will create a container image in a tar inside Nix's store. For
easier access of the tar, Nix creates a symlink of the tar file in the CWD. The
symlink will be named as <code>result</code>. Therefore, we can load the container image with:</p>
<pre><code class="language-bash">docker load &lt; result
</code></pre>
<p>Please check <a href="https://github.com/nubificus/bimanix">bimanix's README</a> for more information.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 - 2025 Nubificus LTD
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>